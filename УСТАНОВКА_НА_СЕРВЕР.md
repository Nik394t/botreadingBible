# 🚀 Установка Bible Reading Bot на сервер

## 📦 Подготовка файлов

Загрузите все файлы проекта на ваш сервер в одну папку.

## ⚡ Быстрая установка

```bash
# 1. Автоматическая установка
./deploy.sh

# 2. Настройте config.js с вашими данными
nano config.js
```

## 🔧 Ручная установка

### 1. Установка зависимостей
```bash
npm install
chmod +x start_bot.sh deploy.sh
```

### 2. Настройка конфигурации
```bash
# Скопируйте пример
cp config.js.example config.js

# Отредактируйте
nano config.js

# Укажите ваши данные:
BOT_TOKEN: '8275285179:AAGXtVvUm4EQr5lKPeZXe--5nme2JormUyA'
GROUP_CHAT_ID: '-4888364969'
```

### 3. Тестирование
```bash
node test_bot.js
```

### 4. Запуск

#### Вариант A: Простой запуск
```bash
./start_bot.sh
```

#### Вариант B: PM2 (рекомендуется для продакшена)
```bash
# Установите PM2
npm install -g pm2

# Запустите бота
pm2 start bot.js --name "bible-bot"
pm2 save
pm2 startup

# Управление
pm2 status
pm2 logs bible-bot
pm2 restart bible-bot
```

#### Вариант C: Systemd service
```bash
# Создайте service файл
sudo nano /etc/systemd/system/bible-bot.service

# Содержимое:
[Unit]
Description=Bible Reading Bot
After=network.target

[Service]
Type=simple
User=your-user
WorkingDirectory=/path/to/bot
ExecStart=/usr/bin/node bot.js
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target

# Активируйте
sudo systemctl enable bible-bot
sudo systemctl start bible-bot
sudo systemctl status bible-bot
```

## 📊 Мониторинг

### Логи
```bash
# Основные логи
tail -f bot.log

# Системные логи (если используете systemd)
sudo journalctl -u bible-bot -f

# PM2 логи
pm2 logs bible-bot
```

### Статус
```bash
# Проверка процесса
ps aux | grep "node bot.js"

# PM2 статус
pm2 status

# Systemd статус
sudo systemctl status bible-bot
```

## 🔒 Безопасность

### Файрвол
```bash
# Разрешите только необходимые порты
sudo ufw allow ssh
sudo ufw allow out 443  # для HTTPS к Telegram API
sudo ufw enable
```

### Права доступа
```bash
# Ограничьте доступ к конфигурации
chmod 600 config.js
chmod 600 .env

# Права на базу данных
chmod 664 bible_bot.db
```

### Резервное копирование
```bash
# Создайте скрипт бэкапа
cat > backup.sh << 'EOF'
#!/bin/bash
DATE=$(date +%Y%m%d_%H%M%S)
cp bible_bot.db "backups/bible_bot_$DATE.db"
find backups/ -name "*.db" -mtime +7 -delete
EOF

chmod +x backup.sh

# Добавьте в crontab
crontab -e
# Добавьте строку:
0 2 * * * /path/to/backup.sh
```

## 🛠️ Устранение неполадок

### Бот не запускается
```bash
# Проверьте Node.js
node --version

# Проверьте зависимости
npm list

# Проверьте конфигурацию
node -e "console.log(require('./config.js'))"

# Запустите в режиме отладки
node bot.js
```

### Проблемы с базой данных
```bash
# Проверьте файл
ls -la bible_bot.db

# Проверьте права
chmod 664 bible_bot.db

# Пересоздайте базу
rm bible_bot.db
node test_bot.js
```

### Проблемы с сетью
```bash
# Проверьте доступ к Telegram API
curl -s https://api.telegram.org/bot<TOKEN>/getMe

# Проверьте DNS
nslookup api.telegram.org

# Проверьте файрвол
sudo ufw status
```

## 📈 Оптимизация

### Производительность
```bash
# Мониторинг ресурсов
htop
free -h
df -h

# Настройка Node.js
export NODE_ENV=production
export NODE_OPTIONS="--max-old-space-size=512"
```

### Автообновление
```bash
# Создайте скрипт обновления
cat > update.sh << 'EOF'
#!/bin/bash
git pull
npm install
pm2 restart bible-bot
EOF

chmod +x update.sh
```

## 📞 Поддержка

При проблемах проверьте:

1. **Логи**: `tail -f bot.log`
2. **Процесс**: `ps aux | grep node`
3. **Конфигурацию**: `node -e "console.log(require('./config.js'))"`
4. **Сеть**: `curl -s https://api.telegram.org/bot<TOKEN>/getMe`

---

**🎉 Бот готов к работе на сервере!**
**📖 Благословенного использования! 🙏**